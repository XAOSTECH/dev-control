name: British English Spelling Check

on:
  push:
    branches:
      - main
      - master
      - develop
    paths:
      - '**.md'
      - '**.sh'
      - '**.yaml'
      - '**.yml'
      - '**.txt'
      - 'docs/**'
  pull_request:
    branches:
      - main
      - master
      - develop
    paths:
      - '**.md'
      - '**.sh'
      - '**.yaml'
      - '**.yml'
      - '**.txt'
      - 'docs/**'
  workflow_dispatch:

permissions:
  contents: read

jobs:
  anglicise:
    name: Check British English Spelling
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check for American spellings
        id: check
        run: |
          # British English Spelling Checker
          # Flags American spellings that should be converted to British equivalents
          #
          # Patterns checked:
          #   -ize â†’ -ise (organize â†’ organise)
          #   -ization â†’ -isation (organization â†’ organisation)
          #   -or â†’ -our (color â†’ colour)
          #   -er â†’ -re (center â†’ centre)
          #   -og â†’ -ogue (catalog â†’ catalogue)
          #   -ense â†’ -ence (defense â†’ defence)
          #   -l- â†’ -ll- (canceled â†’ cancelled)
          #   Other common differences (gray â†’ grey, etc.)

          ISSUES_FOUND=0
          ISSUE_OUTPUT=""

          # American words to check (case-insensitive matching)
          # Each line: american_word|british_word|pattern_category
          read -r -d '' WORD_PAIRS << 'WORDLIST' || true
          organize|organise|-ize â†’ -ise
          organizes|organises|-ize â†’ -ise
          organized|organised|-ize â†’ -ise
          organizing|organising|-ize â†’ -ise
          organization|organisation|-ization â†’ -isation
          organizations|organisations|-ization â†’ -isation
          organizational|organisational|-ization â†’ -isation
          recognize|recognise|-ize â†’ -ise
          recognizes|recognises|-ize â†’ -ise
          recognized|recognised|-ize â†’ -ise
          recognizing|recognising|-ize â†’ -ise
          customize|customise|-ize â†’ -ise
          customizes|customises|-ize â†’ -ise
          customized|customised|-ize â†’ -ise
          customizing|customising|-ize â†’ -ise
          customization|customisation|-ization â†’ -isation
          optimize|optimise|-ize â†’ -ise
          optimizes|optimises|-ize â†’ -ise
          optimized|optimised|-ize â†’ -ise
          optimizing|optimising|-ize â†’ -ise
          optimization|optimisation|-ization â†’ -isation
          optimizations|optimisations|-ization â†’ -isation
          initialize|initialise|-ize â†’ -ise
          initializes|initialises|-ize â†’ -ise
          initialized|initialised|-ize â†’ -ise
          initializing|initialising|-ize â†’ -ise
          initialization|initialisation|-ization â†’ -isation
          synchronize|synchronise|-ize â†’ -ise
          synchronizes|synchronises|-ize â†’ -ise
          synchronized|synchronised|-ize â†’ -ise
          synchronizing|synchronising|-ize â†’ -ise
          synchronization|synchronisation|-ization â†’ -isation
          authorize|authorise|-ize â†’ -ise
          authorizes|authorises|-ize â†’ -ise
          authorized|authorised|-ize â†’ -ise
          authorizing|authorising|-ize â†’ -ise
          authorization|authorisation|-ization â†’ -isation
          normalize|normalise|-ize â†’ -ise
          normalizes|normalises|-ize â†’ -ise
          normalized|normalised|-ize â†’ -ise
          normalizing|normalising|-ize â†’ -ise
          normalization|normalisation|-ization â†’ -isation
          visualize|visualise|-ize â†’ -ise
          visualizes|visualises|-ize â†’ -ise
          visualized|visualised|-ize â†’ -ise
          visualizing|visualising|-ize â†’ -ise
          visualization|visualisation|-ization â†’ -isation
          utilize|utilise|-ize â†’ -ise
          utilizes|utilises|-ize â†’ -ise
          utilized|utilised|-ize â†’ -ise
          utilizing|utilising|-ize â†’ -ise
          utilization|utilisation|-ization â†’ -isation
          finalize|finalise|-ize â†’ -ise
          finalizes|finalises|-ize â†’ -ise
          finalized|finalised|-ize â†’ -ise
          finalizing|finalising|-ize â†’ -ise
          localize|localise|-ize â†’ -ise
          localizes|localises|-ize â†’ -ise
          localized|localised|-ize â†’ -ise
          localizing|localising|-ize â†’ -ise
          localization|localisation|-ization â†’ -isation
          prioritize|prioritise|-ize â†’ -ise
          prioritizes|prioritises|-ize â†’ -ise
          prioritized|prioritised|-ize â†’ -ise
          prioritizing|prioritising|-ize â†’ -ise
          summarize|summarise|-ize â†’ -ise
          summarizes|summarises|-ize â†’ -ise
          summarized|summarised|-ize â†’ -ise
          summarizing|summarising|-ize â†’ -ise
          minimize|minimise|-ize â†’ -ise
          minimizes|minimises|-ize â†’ -ise
          minimized|minimised|-ize â†’ -ise
          minimizing|minimising|-ize â†’ -ise
          maximize|maximise|-ize â†’ -ise
          maximizes|maximises|-ize â†’ -ise
          maximized|maximised|-ize â†’ -ise
          maximizing|maximising|-ize â†’ -ise
          categorize|categorise|-ize â†’ -ise
          categorizes|categorises|-ize â†’ -ise
          categorized|categorised|-ize â†’ -ise
          categorizing|categorising|-ize â†’ -ise
          analyze|analyse|-ize â†’ -ise
          analyzes|analyses|-ize â†’ -ise
          analyzed|analysed|-ize â†’ -ise
          analyzing|analysing|-ize â†’ -ise
          analyzer|analyser|-ize â†’ -ise
          apologize|apologise|-ize â†’ -ise
          apologizes|apologises|-ize â†’ -ise
          apologized|apologised|-ize â†’ -ise
          apologizing|apologising|-ize â†’ -ise
          realize|realise|-ize â†’ -ise
          realizes|realises|-ize â†’ -ise
          realized|realised|-ize â†’ -ise
          realizing|realising|-ize â†’ -ise
          specialize|specialise|-ize â†’ -ise
          specializes|specialises|-ize â†’ -ise
          specialized|specialised|-ize â†’ -ise
          specializing|specialising|-ize â†’ -ise
          specialization|specialisation|-ization â†’ -isation
          standardize|standardise|-ize â†’ -ise
          standardizes|standardises|-ize â†’ -ise
          standardized|standardised|-ize â†’ -ise
          standardizing|standardising|-ize â†’ -ise
          standardization|standardisation|-ization â†’ -isation
          color|colour|-or â†’ -our
          colors|colours|-or â†’ -our
          colored|coloured|-or â†’ -our
          coloring|colouring|-or â†’ -our
          colorful|colourful|-or â†’ -our
          favor|favour|-or â†’ -our
          favors|favours|-or â†’ -our
          favored|favoured|-or â†’ -our
          favoring|favouring|-or â†’ -our
          favorable|favourable|-or â†’ -our
          favorite|favourite|-or â†’ -our
          favorites|favourites|-or â†’ -our
          honor|honour|-or â†’ -our
          honors|honours|-or â†’ -our
          honored|honoured|-or â†’ -our
          honoring|honouring|-or â†’ -our
          honorable|honourable|-or â†’ -our
          humor|humour|-or â†’ -our
          humors|humours|-or â†’ -our
          humored|humoured|-or â†’ -our
          humoring|humouring|-or â†’ -our
          humorous|humourous|-or â†’ -our
          labor|labour|-or â†’ -our
          labors|labours|-or â†’ -our
          labored|laboured|-or â†’ -our
          laboring|labouring|-or â†’ -our
          neighbor|neighbour|-or â†’ -our
          neighbors|neighbours|-or â†’ -our
          neighboring|neighbouring|-or â†’ -our
          neighborhood|neighbourhood|-or â†’ -our
          behavior|behaviour|-or â†’ -our
          behaviors|behaviours|-or â†’ -our
          behavioral|behavioural|-or â†’ -our
          flavor|flavour|-or â†’ -our
          flavors|flavours|-or â†’ -our
          flavored|flavoured|-or â†’ -our
          flavoring|flavouring|-or â†’ -our
          odor|odour|-or â†’ -our
          odors|odours|-or â†’ -our
          rumor|rumour|-or â†’ -our
          rumors|rumours|-or â†’ -our
          vapor|vapour|-or â†’ -our
          vapors|vapours|-or â†’ -our
          vigor|vigour|-or â†’ -our
          vigorous|vigourous|-or â†’ -our
          rigor|rigour|-or â†’ -our
          rigorous|rigourous|-or â†’ -our
          harbor|harbour|-or â†’ -our
          harbors|harbours|-or â†’ -our
          harbored|harboured|-or â†’ -our
          harboring|harbouring|-or â†’ -our
          savior|saviour|-or â†’ -our
          endeavor|endeavour|-or â†’ -our
          endeavors|endeavours|-or â†’ -our
          endeavored|endeavoured|-or â†’ -our
          endeavoring|endeavouring|-or â†’ -our
          center|centre|-er â†’ -re
          centers|centres|-er â†’ -re
          centered|centred|-er â†’ -re
          centering|centring|-er â†’ -re
          liter|litre|-er â†’ -re
          liters|litres|-er â†’ -re
          meter|metre|-er â†’ -re
          meters|metres|-er â†’ -re
          theater|theatre|-er â†’ -re
          theaters|theatres|-er â†’ -re
          fiber|fibre|-er â†’ -re
          fibers|fibres|-er â†’ -re
          caliber|calibre|-er â†’ -re
          specter|spectre|-er â†’ -re
          specters|spectres|-er â†’ -re
          scepter|sceptre|-er â†’ -re
          somber|sombre|-er â†’ -re
          defense|defence|-ense â†’ -ence
          defenses|defences|-ense â†’ -ence
          offense|offence|-ense â†’ -ence
          offenses|offences|-ense â†’ -ence
          pretense|pretence|-ense â†’ -ence
          analog|analogue|-og â†’ -ogue
          analogs|analogues|-og â†’ -ogue
          catalog|catalogue|-og â†’ -ogue
          catalogs|catalogues|-og â†’ -ogue
          cataloged|catalogued|-og â†’ -ogue
          cataloging|cataloguing|-og â†’ -ogue
          dialog|dialogue|-og â†’ -ogue
          dialogs|dialogues|-og â†’ -ogue
          prolog|prologue|-og â†’ -ogue
          epilog|epilogue|-og â†’ -ogue
          canceled|cancelled|-l- â†’ -ll-
          canceling|cancelling|-l- â†’ -ll-
          traveled|travelled|-l- â†’ -ll-
          traveling|travelling|-l- â†’ -ll-
          traveler|traveller|-l- â†’ -ll-
          travelers|travellers|-l- â†’ -ll-
          modeled|modelled|-l- â†’ -ll-
          modeling|modelling|-l- â†’ -ll-
          labeled|labelled|-l- â†’ -ll-
          labeling|labelling|-l- â†’ -ll-
          leveled|levelled|-l- â†’ -ll-
          leveling|levelling|-l- â†’ -ll-
          signaled|signalled|-l- â†’ -ll-
          signaling|signalling|-l- â†’ -ll-
          fueled|fuelled|-l- â†’ -ll-
          fueling|fuelling|-l- â†’ -ll-
          counseled|counselled|-l- â†’ -ll-
          counseling|counselling|-l- â†’ -ll-
          counselor|counsellor|-l- â†’ -ll-
          counselors|counsellors|-l- â†’ -ll-
          gray|grey|gray â†’ grey
          grays|greys|gray â†’ grey
          grayish|greyish|gray â†’ grey
          aging|ageing|aging â†’ ageing
          judgment|judgement|judgment â†’ judgement
          judgments|judgements|judgment â†’ judgement
          acknowledgment|acknowledgement|acknowledgment â†’ acknowledgement
          acknowledgments|acknowledgements|acknowledgment â†’ acknowledgement
          fulfill|fulfil|fulfill â†’ fulfil
          fulfills|fulfils|fulfill â†’ fulfil
          fulfilled|fulfilled|fulfill â†’ fulfil
          fulfilling|fulfilling|fulfill â†’ fulfil
          fulfillment|fulfilment|fulfillment â†’ fulfilment
          skillful|skilful|skillful â†’ skilful
          skillfully|skilfully|skillful â†’ skilful
          willful|wilful|willful â†’ wilful
          willfully|wilfully|willful â†’ wilful
          enroll|enrol|enroll â†’ enrol
          enrolls|enrols|enroll â†’ enrol
          enrolled|enrolled|enroll â†’ enrol
          enrolling|enrolling|enroll â†’ enrol
          enrollment|enrolment|enrollment â†’ enrolment
          installment|instalment|installment â†’ instalment
          installments|instalments|installment â†’ instalment
          plow|plough|plow â†’ plough
          plows|ploughs|plow â†’ plough
          plowed|ploughed|plow â†’ plough
          plowing|ploughing|plow â†’ plough
          WORDLIST

          # Find files to check
          FILES=$(find . -type f \( -name "*.md" -o -name "*.sh" -o -name "*.yaml" -o -name "*.yml" -o -name "*.txt" \) \
            ! -path "./.git/*" \
            ! -path "./node_modules/*" \
            ! -path "./vendor/*" \
            ! -path "./.github/workflows/*" \
            ! -path "./license-templates/*" \
            2>/dev/null | sort)

          echo "## British English Spelling Check" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Process each word pair
          while IFS='|' read -r american british pattern; do
            [[ -z "$american" ]] && continue
            
            # Search for word (case-insensitive, whole word)
            while IFS= read -r file; do
              [[ -z "$file" ]] && continue
              
              # Find matches, excluding file paths and URLs
              MATCHES=$(grep -inw "$american" "$file" 2>/dev/null | \
                grep -vE '(/[a-zA-Z0-9_.-]+\.[a-z]{1,4}|https?://|file://)' || true)
              
              if [[ -n "$MATCHES" ]]; then
                while IFS= read -r match; do
                  [[ -z "$match" ]] && continue
                  LINE_NUM=$(echo "$match" | cut -d: -f1)
                  LINE_CONTENT=$(echo "$match" | cut -d: -f2- | sed 's/^[[:space:]]*//' | head -c 100)
                  
                  ISSUE_OUTPUT+="| \`$file:$LINE_NUM\` | $american | $british | $pattern |"$'\n'
                  ISSUES_FOUND=$((ISSUES_FOUND + 1))
                done <<< "$MATCHES"
              fi
            done <<< "$FILES"
          done <<< "$WORD_PAIRS"

          # Output results
          if [[ $ISSUES_FOUND -gt 0 ]]; then
            echo "âŒ **Found $ISSUES_FOUND American spelling(s) to convert**" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "| Location | American ðŸ‡ºðŸ‡¸ | British ðŸ‡¬ðŸ‡§ | Pattern |" >> $GITHUB_STEP_SUMMARY
            echo "|----------|-------------|------------|---------|" >> $GITHUB_STEP_SUMMARY
            echo "$ISSUE_OUTPUT" >> $GITHUB_STEP_SUMMARY
            
            echo "::error::Found $ISSUES_FOUND American spelling(s). Please convert to British English."
            exit 1
          else
            echo "âœ… **All spellings conform to British English standards.**" >> $GITHUB_STEP_SUMMARY
          fi
